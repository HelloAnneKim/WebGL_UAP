<!-- following this blog generally: http://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html -->

<!-- For the 2 canvases -->
<!-- https://github.com/greggman/webgl-fundamentals/blob/master/webgl/webgl-text-html-canvas2d.html -->
<!-- http://webglfundamentals.org/webgl/lessons/webgl-text-canvas2d.html -->

<!-- For the Rectangles -->
<!-- http://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html -->
<!-- https://github.com/greggman/webgl-fundamentals/blob/master/webgl/webgl-2d-rectangles.html -->
<html>
        <header>
        <h1>Texture Sampling for Squares</h1>
<!--         <h3>Anne Kim is following this blog post: 
        http://www.creativebloq.com/javascript/get-started-webgl-draw-square-7112981 
        to make a square</h3> -->
        <h2></h2>
    </header>
    <meta charset="utf-8"/>
    <head>           
            <script id="vertex" type="x-shader">
                attribute vec2 aVertexPosition;
                attribute vec2 a_texcoord;

                varying vec2 v_texcoord;

                void main() {
                        gl_Position = vec4(aVertexPosition, 0.0, 1.0);

                        // ANNEYKIM: Pass the texcoord to the fragment shader
                        v_texcoord = a_texcoord;
                }
            </script>  
            <script id="fragment" type="x-shader">
                #ifdef GL_ES
                precision highp float;
                #endif
                      
                // uniform vec4 uColor;

                // ANNEYKIM: passed in from the vertex shader
                varying vec2 v_texcoord;

                // ANNEYKIM: the texture
                uniform sampler2D u_texture;
                                       
                void main() {
                        // gl_FragColor = uColor;
                        gl_FragColor = texture2D(u_texture, v_texcoord);
                }
            </script>        
            <script type="text/javascript">

                    
                    // Fill the buffer with the values that define a rectangle.
                    function setRectangle(gl, x, y, width, height) {
                      var x1 = x;
                      var x2 = x + width;
                      var y1 = y;
                      var y2 = y + height;
                      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                         x1, y1,
                         x2, y1,
                         x1, y2,
                         x1, y2,
                         x2, y1,
                         x2, y2]), gl.STATIC_DRAW);
                    }

                    var ctx;
                    function init(){
                        // ANNEYKIM: initialize 3D canvas
                        canvas = document.getElementById("displayedcanvas");
                        gl = canvas.getContext("experimental-webgl");

                        gl.viewport(0, 0, canvas.width, canvas.height);
                        gl.clearColor(0, 0.1, 0.1, .1);
                        gl.clear(gl.COLOR_BUFFER_BIT);

                        var v = document.getElementById("vertex").firstChild.nodeValue;
                        var f = document.getElementById("fragment").firstChild.nodeValue;
                         
                        var vs = gl.createShader(gl.VERTEX_SHADER);
                        gl.shaderSource(vs, v);
                        gl.compileShader(vs);
                         
                        var fs = gl.createShader(gl.FRAGMENT_SHADER);
                        gl.shaderSource(fs, f);
                        gl.compileShader(fs);
                         
                        program = gl.createProgram();
                        gl.attachShader(program, vs);
                        gl.attachShader(program, fs);
                        gl.linkProgram(program);

                        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS))
                            console.log(gl.getShaderInfoLog(vs));
                        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS))
                            console.log(gl.getShaderInfoLog(fs));
                        if (!gl.getProgramParameter(program, gl.LINK_STATUS))
                            console.log(gl.getProgramInfoLog(program));
                        // ANNEYKIM: End initialize 3D canvas

// make a giant rectangle (background) on top of the background (foreground)
// paint smaller rectangles on top of this foreground rectangle (on the displayCanvas)


// make the squareMaking canvas visible
// SEPARATELY MAKE A HTML THAT WILL JUST HAVE ONE CANVAS: MAKE RECTANGLES 



                        // ANNEYKIM: set up 2D canvas
                        var squaremakingcanvas = document.getElementById("squaremakingcanvas");
                        // ANNEYKIM: request a 2D context for the 2D canvas
                         ctx = squaremakingcanvas.getContext("2d");
                        
                        // look up where the vertex data needs to go.
                        // var positionLocation = gl.getAttribLocation(program, "a_position");
                        var texcoordLocation = gl.getAttribLocation(program, "a_texcoord");
                        
                        
// texture coords go into the buffer

                        // Create a buffer for texcoords.
                        var buffer = gl.createBuffer();
                        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                        gl.enableVertexAttribArray(texcoordLocation);
                        // We'll supply texcoords as floats.
                        // gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);
                        // // Set Texcoords.
                        // setTexcoords(gl);

                        // Create a texture.
                        var texture = gl.createTexture();
                        gl.bindTexture(gl.TEXTURE_2D, texture);
                        // Fill the texture with a 1x1 blue pixel.
                        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE,
                                      new Uint8Array([0, 0, 255, 255]));
                        // Asynchronously load an image
                        // var image = new Image();
                        // image.src = "resources/f-texture.png";
                        // image.addEventListener('load', function() {
                        //   // Now that the image has loaded make copy it to the texture.
                        //   gl.bindTexture(gl.TEXTURE_2D, texture);
                        //   gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA,gl.UNSIGNED_BYTE, image);
                        //   gl.generateMipmap(gl.TEXTURE_2D);
                        // });

                        // Create a buffer.
                        var buffer = gl.createBuffer();
                        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
                        gl.enableVertexAttribArray(texcoordLocation);
                        gl.vertexAttribPointer(texcoordLocation, 2, gl.FLOAT, false, 0, 0);
                        // draw 50 random rectangles in random colors
                        for (var ii = 0; ii < 50; ++ii) {
                          // Setup a random rectangle
                          setRectangle(
                              gl, 22, 22, 22, 22);
                          // Fill the texture with a 1x1 blue pixel.
                            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE,
                new Uint8Array([0, 0, 255, 255]));
                          // Draw the rectangle.
                          gl.drawArrays(gl.TRIANGLES, 0, 6);
                        }

                       

                    }
            </script>
    </head>
    <body onload="init()">
            <div class="container">
                <canvas id="displayedcanvas" width="800" height="500"></canvas>
                <canvas id="squaremakingcanvas" width="800" height="500"></canvas>

            </div>
    </body>
</html>
