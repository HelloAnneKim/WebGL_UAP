<!DOCTYPE html>
<html>
    <header>
        <h1>Mousing and Drawing Squares</h1>
    </header>
    <meta charset="utf-8"/>
<head>
    <script src="mouse-utils.js"></script>
    <script src="squareDrawing-utils.js"></script>
    <script src="webGLSetup-utils.js"></script>
    <script src="paintedRectangle-utils.js"></script>

    <script id="vertex" type="x-shader">
        // attribute vec4 a_position;
        // attribute vec2 a_texcoord;

        // uniform mat4 u_matrix;

        // varying vec2 v_texcoord;

        // void main() {
        //   // Multiply the position by the matrix.
        //   gl_Position = u_matrix * a_position;

        //   // Pass the texcoord to the fragment shader.
        //   v_texcoord = a_texcoord;
        // }

        attribute vec2 a_position;
        attribute vec2 a_texCoord;

        uniform vec2 u_resolution;

        varying vec2 v_texCoord;

        void main() {
           // convert the rectangle from pixels to 0.0 to 1.0
           vec2 zeroToOne = a_position / u_resolution;

           // convert from 0->1 to 0->2
           vec2 zeroToTwo = zeroToOne * 2.0;

           // convert from 0->2 to -1->+1 (clipspace)
           vec2 clipSpace = zeroToTwo - 1.0;

           gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

           // pass the texCoord to the fragment shader
           // The GPU will interpolate this value between points.
           v_texCoord = a_texCoord;
        }

        
    </script>
    <script id="fragment" type="x-shader">
        precision mediump float;
        // Passed in from the vertex shader.
        // varying vec2 v_texcoord;
        // // The texture.
        // uniform sampler2D u_texture;
        // void main() {
        //    gl_FragColor = texture2D(u_texture, v_texcoord);
        // }

        // our texture
        uniform sampler2D u_image;

        // the texCoords passed in from the vertex shader.
        varying vec2 v_texCoord;

        void main() {
           gl_FragColor = texture2D(u_image, v_texCoord);
        }

    </script>
        
    <script type="text/javascript">
        // TODO: figure out how to set this up
        var canvasWidth = 800;
        var canvasHeight = 500;
        var clearColor = [0, 0.2, 0.2, 0.2]; //baby blue
        var shiftLeft = 50;
        var shiftTop = 100;
        
        // size of square sides
        smallSide = 10;
        largeSide = 50;

        function continuousDrawing(event) {
            console.log("painting x,y: "+lastMouseX+", "+lastMouseY);
            // at the corners the paintingColor will change
            if (lastMouseX<shiftLeft+largeSide && lastMouseY<shiftTop+largeSide) {
                paintingColor = topLeftColor;
            } else if (lastMouseX>canvasWidth+shiftLeft-largeSide && lastMouseY<shiftTop+largeSide) {
                paintingColor = topRightColor;
            } else if (lastMouseX<shiftLeft+largeSide && lastMouseY>canvasHeight+shiftTop-largeSide) {
                paintingColor = bottomLeftColor;
            } else if (lastMouseX>canvasWidth+shiftLeft-largeSide && lastMouseY>canvasHeight+shiftTop-largeSide) {
                paintingColor = bottomRightColor;
            } else if (mouseDown) { 
                // Otherwise, when the mouse is down, it will paint
                setSmallSquare(lastMouseX-shiftLeft,lastMouseY-shiftTop, paintingColor);
            } 
            // else: do nothing
        }

        function init() {
            
            setupSquareMakingCanvas(canvasWidth,canvasHeight);
            setupDisplayedCanvas(canvasWidth, canvasHeight, clearColor);
            setupShaders();
            setupCornerColoringSquares(canvasWidth,canvasHeight);
            
            listenToMouse(displayedCanvas);
            displayedCanvas.addEventListener("mousedown",continuousDrawing);
            document.addEventListener("mousemove", continuousDrawing);

            // create 3D rectangle to paint on
            createPaintedRectangle();
        }
    </script>
</head>

<body onload="init();">
    <canvas id="squareMakingCanvas" 
        style="z-index: 1;
        position:absolute;
        left:50px;
        top:100px;
        "
        width="800" height="500">
    </canvas>
    <canvas id="displayedCanvas" style="z-index: 1;
        position:absolute;
        left:50px;
        top:100px;
        " width="800" height="500">
    </canvas>
</body>
</html>