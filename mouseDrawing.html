<!DOCTYPE html>
<html>
    <header>
        <h1>Mousing and Drawing Squares</h1>
    </header>
    <meta charset="utf-8"/>
<head>
    <script src="mouse-utils.js"></script>
    <script src="squareDrawing-utils.js"></script>
    <script src="webGLSetup-utils.js"></script>

    <script id="vertex" type="x-shader">
        attribute vec2 a_position;
        void main() {gl_Position = vec4(a_position, 0.0, 1.0);}
    </script>
    <script id="fragment" type="x-shader">
        #ifdef GL_ES
        precision highp float;
        #endif
        uniform vec4 uColor;
        void main() {
            gl_FragColor = uColor;
        }
    </script>
        
    <script type="text/javascript">
        // TODO: figure out how to set this up
        var canvasWidth = 800;
        var canvasHeight = 500;
        var clearColor = [0, 0.2, 0.2, 0.2]; //baby blue
        var shiftLeft = 50;
        var shiftTop = 100;
        
        // size of square sides
        smallSide = 10;
        largeSide = 50;

        function continuousDrawing(event) {
            console.log("painting x,y: "+lastMouseX+", "+lastMouseY);
            // at the corners the paintingColor will change
            if (lastMouseX<shiftLeft+largeSide && lastMouseY<shiftTop+largeSide) {
                paintingColor = topLeftColor;
            } else if (lastMouseX>canvasWidth+shiftLeft-largeSide && lastMouseY<shiftTop+largeSide) {
                paintingColor = topRightColor;
            } else if (lastMouseX<shiftLeft+largeSide && lastMouseY>canvasHeight+shiftTop-largeSide) {
                paintingColor = bottomLeftColor;
            } else if (lastMouseX>canvasWidth+shiftLeft-largeSide && lastMouseY>canvasHeight+shiftTop-largeSide) {
                paintingColor = bottomRightColor;
            } else if (mouseDown) { 
                // Otherwise, when the mouse is down, it will paint
                setSmallSquare(lastMouseX-shiftLeft,lastMouseY-shiftTop, paintingColor);
            } 
            // else: do nothing
        }

        function createPaintedRectangle() {
            var aspect = displayedCanvas.width / displayedCanvas.height;
            var vertices = new Float32Array([
                    -0.25, 0.25*aspect, 0.25, 0.25*aspect,  0.25,-0.25*aspect,  // Triangle 1
                    -0.25, 0.25*aspect, 0.25,-0.25*aspect, -0.25,-0.25*aspect   // Triangle 2
                    ]);
             
            vbuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, vbuffer);                                       
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
             
            itemSize = 2;
            numItems = vertices.length / itemSize;

            gl.useProgram(program);

            program.uColor = gl.getUniformLocation(program, "uColor");
            gl.uniform4fv(program.uColor, [100, 100, 0.0, 1.0]);
             
            // look up where the vertex data needs to go
            program.a_position = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(program.a_position);
            gl.vertexAttribPointer(program.a_position, itemSize, gl.FLOAT, false, 0, 0);

            gl.drawArrays(gl.TRIANGLES, 0, numItems);
        }

        function init() {
            
            setupSquareMakingCanvas(canvasWidth,canvasHeight);
            setupDisplayedCanvas(canvasWidth, canvasHeight, clearColor);
            setupShaders();
            setupCornerColoringSquares(canvasWidth,canvasHeight);
            
            listenToMouse(displayedCanvas);
            displayedCanvas.addEventListener("mousedown",continuousDrawing);
            document.addEventListener("mousemove", continuousDrawing);

            // create 3D rectangle to paint on
            createPaintedRectangle();
        }
    </script>
</head>

<body onload="init();">
    <canvas id="squareMakingCanvas" 
        style="z-index: 1;
        position:absolute;
        left:50px;
        top:100px;
        "
        width="800" height="500">
    </canvas>
    <canvas id="displayedCanvas" style="z-index: 1;
        position:absolute;
        left:50px;
        top:100px;
        " width="800" height="500">
    </canvas>
</body>
</html>